<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"> <!-- Set the character encoding -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Make the page responsive -->
  <title>Settings - Book & Notes Vault</title>
  <!-- CSS file that contains design tokens (colors, spacing) -->
  <link rel="stylesheet" href="styles/tokens.css">
  <!-- CSS file for the base foundation of the website (typography, reset) -->
  <link rel="stylesheet" href="styles/base.css">
  <!-- CSS files that is the backbone of the website (cards, buttons, hero) -->
  <link rel="stylesheet" href="styles/components.css">
  <!-- Utility classes (spacing, text alignment) -->
  <link rel="stylesheet" href="styles/utilities.css">
</head>
<body>
  <!-- Skip link so keyboard users can jump to main content -->
  <a href="#main" class="skip-link">Skip to main content</a>
  
  <!-- ---------------------------------------------
       HEADER: Main navigation bar
  ---------------------------------------------- -->
  <header class="header">
    <nav class="nav" aria-label="Main navigation">
      <a href="index.html">About</a> <!-- Link to About page -->
      <a href="dashboard.html">Dashboard</a> <!-- Link to Dashboard page -->
      <a href="records.html">My Records</a> <!-- Link to Records page -->
      <a href="form.html">Add Book</a> <!-- Link to Add Book page -->
      <a href="settings.html" aria-current="page">Settings</a> <!-- Current page -->
    </nav>
  </header>

  <!-- ---------------------------------------------
       MAIN CONTENT: Settings options 
  ---------------------------------------------- -->
  <main id="main" class="container">
    <h1 class="mt-lg">Settings</h1>

    <!-- THEME SETTINGS: Light/dark mode and color schemes -->
    <section class="card mb-lg">
      <h2>Theme</h2>
      
      <!-- Light/dark theme switch -->
      <div class="form-group">
        <label class="form-label">Mode</label> <!-- Theme mode label -->
        <div class="flex gap-md">
          <button class="btn" id="lightTheme">Light</button> <!-- Switch to light theme -->
          <button class="btn" id="darkTheme">Dark</button> <!-- Switch to dark theme -->
        </div>
      </div>

      <!-- Color scheme choices -->
      <div class="form-group">
        <label class="form-label">Color Scheme</label> <!-- Color scheme label -->
        <div class="theme-swatches">
          <button class="swatch active" id="defaultScheme" style="background: linear-gradient(135deg, #C9A227 50%, #7B1E1E 50%);" aria-label="Default colors"></button> <!-- Default colors -->
          <button class="swatch" id="warmScheme" style="background: linear-gradient(135deg, #D4A017 50%, #8B0000 50%);" aria-label="Warm colors"></button> <!-- Warm palette -->
          <button class="swatch" id="coolScheme" style="background: linear-gradient(135deg, #B8860B 50%, #6B1E1E 50%);" aria-label="Cool colors"></button> <!-- Cool palette -->
        </div>
      </div>
    </section>

    <!-- ---------------------------------------------
        UNITS & GOALS: Choose unit and reading goal
    ---------------------------------------------- -->
    <section class="card mb-lg">
      <h2>Units & Goals</h2>
      
      <!-- Unit selection -->
      <div class="form-group">
        <label for="unitSelect" class="form-label">Display Unit</label> <!-- Label for unit -->
        <select id="unitSelect" class="form-select"> <!-- Choose pages/hours/days/etc -->
          <option value="pages">Pages</option>
          <option value="hours">Hours</option>
          <option value="days">Days</option>
          <option value="minutes">Minutes</option>
        </select>
      </div>

      <!-- Reading goal input -->
      <div class="form-group">
        <label for="goalInput" class="form-label">Reading Goal</label> <!-- Label for goal -->
        <input type="number" id="goalInput" class="form-input" min="1"> <!-- Enter numeric goal -->
        <p class="text-muted mt-sm">Set your target in the selected unit</p> <!-- Help text -->
      </div>

      <!-- Button to save updated settings -->
      <button class="btn" id="saveUnits">Save Units & Goals</button>
    </section>

    <!-- ---------------------------------------------
         DATA MANAGEMENT: Import/export records
    ---------------------------------------------- -->
    <section class="card mb-lg">
      <h2>Data Management</h2>
      
      <!-- Import JSON file -->
      <div class="form-group">
        <label for="importFile" class="form-label">Import Data</label> <!-- Label for upload -->
        <input type="file" id="importFile" accept=".json" class="form-input"> <!-- Choose JSON file -->
        <p class="text-muted mt-sm">Upload a JSON file to import records</p>
      </div>

      <!-- Export JSON file -->
      <div class="form-group">
        <button class="btn" id="exportBtn">Export Data</button> <!-- Download records as JSON -->
        <p class="text-muted mt-sm">Download your records as JSON</p>
      </div>
    </section>
  </main>

  <!-- ---------------------------------------------
       FOOTER: Website footer with links and contacts
  ---------------------------------------------- -->
  <footer class="footer" aria-labelledby="site-footer-title">
    <div class="footer-content">

      <!-- Brand name and copyright -->
      <section class="footer-col">
        <h3 id="site-footer-title">Book &amp; Notes Vault</h3> <!-- Footer brand title -->
        <p class="text-muted">Your personal library companion.</p> <!-- Short description -->
        <p class="tiny text-muted">
          &copy; <span id="year"></span> Book &amp; Notes Vault. All rights reserved. <!-- Autoâ€‘updated year -->
        </p>
      </section>

      <!-- Quick links (same as header) -->
      <nav class="footer-col" aria-label="Quick links">
        <h4>Quick Links</h4>
        <ul class="footer-list">
          <li><a href="index.html">About</a></li> <!-- Link to About page -->
          <li><a href="dashboard.html">Dashboard</a></li> <!-- Link to Dashboard page -->
          <li><a href="records.html">My Records</a></li> <!-- Link to Records page -->
          <li><a href="form.html">Add Book</a></li> <!-- Link to Add Book page -->
          <li><a href="settings.html">Settings</a></li> <!-- Link to Settings page -->
        </ul>
      </nav>

      <!-- Category shortcuts -->
      <nav class="footer-col" aria-label="Book categories">
        <h4>Categories</h4>
        <ul class="footer-list">
          <li><a href="form.html?category=Agriculture">Agriculture</a></li> <!-- Category link -->
          <li><a href="form.html?category=Arts%20%26%20Culture">Arts &amp; Culture</a></li> <!-- Category link -->
          <li><a href="form.html?category=Entrepreneurship">Entrepreneurship</a></li> <!-- Category link -->
          <li><a href="form.html?category=Social%20Sciences">Social Sciences</a></li> <!-- Category link -->
        </ul>
      </nav>

      <!-- Contact information and social media -->
      <section class="footer-col" aria-label="Contact and social">
        <h4>Contact</h4>

        <ul class="footer-list">
          <li>Email: <a href="mailto:h.druppi@valut.com">h.druppi@valut.com</a></li> <!-- Email link -->
          <li>Phone: <a href="tel:+250795000000">+250 795 000 000</a></li> <!-- Phone link -->
          <li>GitHub: <a href="https://github.com/Bol-Dau" target="_blank" rel="noopener">Bol-Dau</a></li> <!-- GitHub link -->
        </ul>

        <!-- Social media icons -->
        <div class="footer-social" aria-label="Social media">

          <!-- Instagram -->
          <a class="social-link" href="https://instagram.com/boydruppi" target="_blank" rel="noopener" aria-label="Instagram">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3Zm-5 3.5A5.5 5.5 0 1 1 6.5 13 5.5 5.5 0 0 1 12 7.5Zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5Zm5.75-2.25a1 1 0 1 1-1 1 1 1 0 0 1 1-1Z"/>
            </svg>
          </a>

          <!-- Facebook -->
          <a class="social-link" href="https://facebook.com/boydruppi" target="_blank" rel="noopener" aria-label="Facebook">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M13 3h3a1 1 0 0 1 1 1v3h-3a2 2 0 0 0-2 2v3h5l-1 4h-4v7h-4v-7H6v-4h3V9a5 5 0 0 1 5-5Z"/>
            </svg>
          </a>

          <!-- X / Twitter -->
          <a class="social-link" href="https://twitter.com/boydruppi" target="_blank" rel="noopener" aria-label="Twitter">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M3 3h4.6l5.2 7.5L19 3h2l-7 9.7L21 21h-4.6l-5.5-8L7 21H5l7-9.7L3 3Z"/>
            </svg>
          </a>

          <!-- TikTok -->
          <a class="social-link" href="https://tiktok.com/@boydruppi" target="_blank" rel="noopener" aria-label="TikTok">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M14 3h3c.2 2 1.2 3.6 3 4.6V11c-2.2-.4-3.9-1.5-5-3v6.7a6.2 6.2 0 1 1-6.2-6.2c.4 0 .8 0 1.2.1V11a2.8 2.8 0 1 0 2 2.7V3Z"/>
            </svg>
          </a>

        </div>
      </section>

    </div>
  </footer>

  <!-- PAGE SCRIPTS: Theme, units, goals, and data handling -->
  <script type="module">
    import { getSettings, updateSettings, applyTheme } from './scripts/settings.js'; /* Load and update settings */
    import { exportRecords, importRecords, getRecords } from './scripts/state.js'; /* Export/import records */
    import { announce, showModal } from './scripts/ui.js'; /* Voice announcements and modals */

    applyTheme(); /* Apply the saved theme on load */

    const settings = getSettings(); /* Load current saved settings */

    document.getElementById('unitSelect').value = settings.unit; /* Fill unit dropdown */
    document.getElementById('goalInput').value = settings.goal; /* Fill goal input */

    document.getElementById('lightTheme').addEventListener('click', () => {
      updateSettings({ theme: 'light' }); /* Change to light theme */
      announce('Switched to light theme'); /* Screen reader message */
    });

    document.getElementById('darkTheme').addEventListener('click', () => {
      updateSettings({ theme: 'dark' }); /* Change to dark theme */
      announce('Switched to dark theme'); /* Screen reader message */
    });

    const swatches = { /* Map swatch id to scheme name */
      defaultScheme: 'default',
      warmScheme: 'warm',
      coolScheme: 'cool'
    };

    // Add click handlers to color scheme swatches
    Object.keys(swatches).forEach(id => {
      document.getElementById(id).addEventListener('click', () => {
        document.querySelectorAll('.swatch').forEach(s => s.classList.remove('active')); /* Remove active */
        document.getElementById(id).classList.add('active'); /* Mark clicked swatch active */
        updateSettings({ colorScheme: swatches[id] }); /* Save new color scheme */
        announce(`Color scheme changed to ${swatches[id]}`); /* Speak update */
      });
    });

    // Save units and goals to localStorage
    document.getElementById('saveUnits').addEventListener('click', () => {
      const unit = document.getElementById('unitSelect').value; /* Get selected unit */
      const goal = parseInt(document.getElementById('goalInput').value); /* Get goal number */
      
      if (goal > 0) { /* Validate goal */
        updateSettings({ unit, goal }); /* Save settings */
        announce(`Settings saved: ${goal} ${unit}`, 'polite'); /* Speak update */
      } else {
        announce('Goal must be greater than 0', 'assertive'); /* Speak error */
      }
    });

    // Export records as JSON file
    document.getElementById('exportBtn').addEventListener('click', () => {
      const data = exportRecords(); /* Export all records */
      const blob = new Blob([data], { type: 'application/json' }); /* Turn into JSON file */
      const url = URL.createObjectURL(blob); /* Create temporary download link */
      const a = document.createElement('a'); /* Make link element */
      a.href = url;
      a.download = `book-vault-${new Date().toISOString().split('T')[0]}.json`; /* Name the file by date */
      a.click(); /* Trigger download */
      URL.revokeObjectURL(url); /* Clean up memory */
      announce('Data exported successfully'); /* Speak success */
    });

    // Import records from JSON file
    document.getElementById('importFile').addEventListener('change', (e) => {
      const file = e.target.files[0]; /* Get uploaded file */
      if (!file) return;

      const reader = new FileReader(); /* Read file contents */
      reader.onload = (event) => {
        try {
          const data = JSON.parse(event.target.result); /* Parse JSON */

          if (!Array.isArray(data)) { /* Validate JSON shape */
            announce('Invalid file format', 'assertive');
            return;
          }

          const currentCount = getRecords().length; /* Old record count */
          const newCount = data.length; /* New record count */

          showModal(
            'Confirm Import',
            `This will replace ${currentCount} records with ${newCount} new ones. Continue?`,
            () => {
              importRecords(data); /* Replace all records */
              announce(`Imported ${newCount} records`); /* Speak result */
              window.location.reload(); /* Reload to show updates */
            }
          );

        } catch (err) {
          announce('Failed to parse JSON file', 'assertive'); /* JSON parse error */
        }
      };
      reader.readAsText(file); /* Read uploaded file */
    });

    document.getElementById(settings.colorScheme + 'Scheme')?.classList.add('active'); /* Highlight selected scheme */

    document.getElementById('year').textContent = new Date().getFullYear(); /* Set current year automatically */
  </script>
</body>
</html>